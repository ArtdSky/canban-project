# API Тестирование

Этот каталог содержит `.http` файлы для тестирования API через REST Client расширение для VS Code.

## Структура файлов

```
test_api_example/
├── login_and_reg/        # Аутентификация
│   ├── register.http     # Регистрация
│   ├── login.http        # Авторизация
│   └── logout.http       # Выход
├── user/                 # Пользователь
│   └── show.http         # Получить текущего пользователя
├── tasks/                # Задачи (CRUD)
│   ├── list.http         # Список задач (с фильтрацией по статусу)
│   ├── create.http       # Создание задачи
│   ├── show.http         # Просмотр задачи
│   ├── update.http       # Обновление задачи
│   └── delete.http       # Удаление задачи
└── comments/             # Комментарии (CRUD)
    ├── list_by_task.http # Список комментариев задачи
    ├── create.http       # Создание комментария
    ├── show.http         # Просмотр комментария
    ├── update.http       # Обновление комментария
    └── delete.http       # Удаление комментария
```

## Использование

1. **Установите REST Client расширение** для VS Code (если еще не установлено)

2. **Получите токен авторизации:**
   - Выполните запрос из `login_and_reg/register.http` для регистрации
   - Выполните запрос из `login_and_reg/login.http` для авторизации
   - Скопируйте `token` из ответа

3. **Установите токен:**
   - Откройте любой `.http` файл
   - Замените `@token = your-token-here` на ваш токен
   - Или установите токен глобально во всех файлах

4. **Выполните запросы:**
   - Нажмите "Send Request" над каждым запросом
   - Или используйте сочетание клавиш `Ctrl+Alt+R` (Linux/Windows) / `Cmd+Alt+R` (Mac)

## API Endpoints

### Аутентификация
- `POST /api/register` - Регистрация (не возвращает токен)
- `POST /api/login` - Авторизация (возвращает токен)
- `POST /api/logout` - Выход (требует токен)
- `GET /api/user` - Получить текущего пользователя (требует токен)

### Задачи
- `GET /api/tasks` - Список задач (с фильтрацией `?status=todo|in_progress|done`)
- `POST /api/tasks` - Создание задачи
- `GET /api/tasks/{task}` - Просмотр задачи
- `PUT /api/tasks/{task}` - Обновление задачи
- `DELETE /api/tasks/{task}` - Удаление задачи

### Комментарии
- `GET /api/tasks/{task}/comments` - Список комментариев задачи
- `POST /api/tasks/{task}/comments` - Создание комментария
- `GET /api/comments/{comment}` - Просмотр комментария
- `PUT /api/comments/{comment}` - Обновление комментария
- `DELETE /api/comments/{comment}` - Удаление комментария (скрытие)

## Важные замечания

1. **Регистрация не возвращает токен** - после регистрации нужно авторизоваться через `/api/login`

2. **Доступ к задачам и комментариям:**
   - Пользователь может видеть/редактировать только те задачи, в которых он является участником
   - Участники задачи определяются через таблицу `task_participants` с ролями: `creator`, `assignee`, `observer`
   - Один пользователь может иметь несколько ролей в одной задаче (например, быть создателем и исполнителем одновременно)
   - Комментарии доступны только к задачам, к которым у пользователя есть доступ

3. **Создание и обновление задач:**
   - При создании задачи пользователь автоматически становится создателем (`creator`)
   - Исполнители указываются в массиве `assignee_ids` (может быть несколько)
   - Наблюдатели указываются в массиве `observer_ids` (может быть несколько)
   - Пример: `{"title": "...", "assignee_ids": [2, 3], "observer_ids": [4]}`
   - При обновлении можно обновить списки исполнителей и/или наблюдателей отдельно

4. **Статусы задач (State Machine):**
   - `todo` → `in_progress` или `done`
   - `in_progress` → `todo` или `done`
   - `done` → `in_progress` (можно вернуться в работу)
   - Прямой переход `todo` → `done` разрешен

5. **Статусы комментариев (State Machine):**
   - `visible` → `hidden`
   - `hidden` → `visible` (можно восстановить)

6. **Удаление комментариев:**
   - Комментарии не удаляются физически, а скрываются (status = hidden)
   - Комментарий можно восстановить, изменив статус обратно на `visible`

## Переменные

В каждом файле используются переменные:
- `@baseUrl = http://localhost:8080` - базовый URL API
- `@token = your-token-here` - токен авторизации (замените на ваш)

Для удобства можно создать общий файл с переменными, но в данном проекте переменные определены в каждом файле для независимости.
